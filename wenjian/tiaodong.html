<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>聊天歌词 · 滚轮刮擦版</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; overflow: hidden; background: #000; }
        body {user-select: none;}

        #background {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 160%;
            background: linear-gradient(135deg, #12003b, #3a0088, #8b00ff);
            background-image: url('https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?auto=format&fit=crop&q=80');
            background-size: cover;
            background-position: center;
            transition: transform 0.4s ease-out;
            z-index: 1;
        }

        #lyrics-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100vh;
            display: flex;
            justify-content: center;
            z-index: 2;
            pointer-events: none;
        }

        #lyrics-inner {
            width: 90%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            padding: 15vh 0;
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .message {
            display: flex;
            align-items: center;
            margin: 18px 20px;
            opacity: 0.55;
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .message.left  { justify-content: flex-start; }
        .message.right  { justify-content: flex-end; }

        .avatar {
            width: 46px; height: 46px; border-radius: 50%;
            background-size: cover; background-position: center;
            flex-shrink: 0; box-shadow: 0 4px 15px rgba(0,0,0,0.6);
        }

        .bubble {
            max-width: 76%;
            padding: 14px 22px;
            border-radius: 24px;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(12px);
            font-size: 1.35rem;
            line-height: 1.45;
            color: white;
            font-weight: 500;
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .message.active .bubble {
            transform: scale(1.45);
            background: rgba(255,255,255,0.92);
            color: #000;
            font-weight: 800;
            font-size: 2.8rem !important;
            box-shadow: 0 0 40px rgba(139, 0, 255, 0.8);
            animation: musicPop 3s infinite ease-in-out;
        }

        @keyframes musicPop {
            0%, 100% { transform: scale(1.45); }
            50% { transform: scale(1.52); }
        }

        .message.active {
            opacity: 1 !important;
        }

        audio { display: none; }
    </style>
</head>
<body>

<div id="background"></div>

<audio id="audio" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" preload="auto"></audio>

<div id="lyrics-container">
    <div id="lyrics-inner"></div>
</div>

<script>
    const lyrics = [
        {time: 0,   text: "窗外雨在下"},
        {time: 12,  text: "心里歌在唱"},
        {time: 24,  text: "像Apple Music一样"},
        {time: 36,  text: "当前行悦动弹出"},
        {time: 48,  text: "滚轮刮擦进度"},
        {time: 60,  text: "头像左右对齐"},
        {time: 72,  text: "左右都有头像"},
        {time: 84,  text: "差速视差超丝滑"},
        {time: 96,  text: "背景慢歌词快"},
        {time: 108, text: "悦动放大呼吸"},
        {time: 120, text: "完全滚轮控制"},
        {time: 132, text: "不想自动就停"},
        {time: 144, text: "想快进就猛滚"},
        {time: 156, text: "想倒退就反滚"},
        {time: 168, text: "Grok 太懂你了"},
        {time: 180, text: "再滚快点"},
        {time: 192, text: "快到底了哦"},
        {time: 204, text: "最后一句也放大"},
        {time: 216, text: "❤️"}
    ];

    const audio = document.getElementById('audio');
    const lyricsInner = document.getElementById('lyrics-inner');
    const background = document.getElementById('background');
    const lyricsContainer = document.getElementById('lyrics-container');

    let duration = 228; // SoundHelix Song 1 时长约228秒
    let currentTime = 0;
    let hasPlayed = false;

    // 创建歌词
    lyrics.forEach((line, i) => {
        const msg = document.createElement('div');
        msg.classList.add('message');
        msg.classList.add(i % 2 === 0 ? 'left' : 'right');

        const avatarUrl = i % 2 === 0 
            ? 'https://randomuser.me/api/portraits/women/68.jpg' 
            : 'https://randomuser.me/api/portraits/men/68.jpg';

        if (i % 2 === 0) {
            // left
            msg.innerHTML = `<div class="avatar" style="background-image:url(${avatarUrl})"></div><div class="bubble">${line.text}</div>`;
        } else {
            // right
            msg.innerHTML = `<div class="bubble">${line.text}</div><div class="avatar" style="background-image:url(${avatarUrl})"></div>`;
        }

        lyricsInner.appendChild(msg);
    });

    audio.onloadedmetadata = () => duration = audio.duration;

    function update() {
        // 找当前行
        let activeIndex = lyrics.length - 1;
        for (let i = 0; i < lyrics.length; i++) {
            if (currentTime < lyrics[i].time) {
                activeIndex = i - 1;
                break;
            }
        }
        if (currentTime >= lyrics[lyrics.length - 1].time) activeIndex = lyrics.length - 1;

        // 高亮
        document.querySelectorAll('.message').forEach((m, i) => {
            m.classList.toggle('active', i === activeIndex);
        });

        // 居中当前行（放大后也基本准）
        const activeEl = document.querySelector('.message.active');
        if (activeEl) {
            const top = activeEl.offsetTop + activeEl.offsetHeight / 2 - lyricsContainer.clientHeight / 2;
            lyricsInner.style.transform = `translateY(-${top}px)`;
        }

        // 背景差速视差
        const progress = currentTime / duration;
        background.style.transform = `translateY(${progress * -380}px) scale(1.05)`;

        requestAnimationFrame(update);
    }

    document.addEventListener('wheel', e => {
        e.preventDefault();
        currentTime += e.deltaY > 0 ? 3.5 : -3.5; // 灵敏度超丝滑
        currentTime = Math.max(0, Math.min(duration, currentTime));
        audio.currentTime = currentTime;

        if (!hasPlayed) {
            audio.play();
            hasPlayed = true;
        }
    }, {passive: false});

    audio.ontimeupdate = () => {
        currentTime = audio.currentTime; // 如果想让它自动播也可以用这行
        update();
    };

    // 初始 + 自动刷新
    update();
    setInterval(update, 2000); // 防止不滚轮时不更新
</script>
</body>
</html>
